<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>√âv√©nements CGR, Arena, Republic Corner, Parc Expo, TAP & Confort Moderne ‚Äì Poitiers</title>

    <style>
      :root {
        --bg: #f7f7f7;
        --panel: #ffffff;
        --muted: #555;
        --text: #111;
        --brand: #097d4c;
        --brand-2: #13b46d;
        --border: #ddd;
        --card: #fff;
      }

      * { box-sizing: border-box; margin: 0; padding: 0; }

      html, body {
        background: var(--bg);
        color: var(--text);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
      }

      .hero {
        background-image: url('https://www.hifrance.org/wp-content/uploads/2025/10/Poitiers-Site-HI-Banniere.jpg');
        background-size: cover;
        background-position: center;
        height: 220px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-shadow: 0 2px 6px rgba(0,0,0,0.4);
      }

      .hero h1 {
        background: rgba(0,0,0,0.35);
        padding: 14px 28px;
        border-radius: 12px;
        font-size: clamp(26px, 3vw, 38px);
      }

      /* Barre de recherche + filtres */
      .search-bar {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: var(--bg);
        padding: 16px;
        position: sticky;
        top: 0;
        z-index: 100;
        border-bottom: 1px solid var(--border);
      }

      .search-bar input {
        width: 100%;
        max-width: 550px;
        padding: 10px 14px;
        border: 1px solid var(--border);
        border-radius: 12px;
        font-size: 15px;
        outline: none;
        transition: box-shadow 0.2s;
        margin-bottom: 10px;
      }

      .search-bar input:focus {
        box-shadow: 0 0 0 2px var(--brand-2);
        border-color: var(--brand);
      }

      .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
      }

      .filter-item {
        align-items: center;
        gap: 6px;
        background: white;
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 6px 10px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .filter-item:hover {
        border-color: var(--brand);
        background: #f0fef8;
      }

      .filter-item input[type="checkbox"] {
        accent-color: var(--brand);
        cursor: pointer;
      }

      .wrap {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 16px;
      }

      .section-title {
        margin-top: 36px;
        margin-bottom: 12px;
        font-size: 22px;
        font-weight: 700;
        color: var(--brand);
        border-left: 5px solid var(--brand);
        padding-left: 8px;
      }

      /* --- CARROUSELS --- */
      .carousel-container {
        position: relative;
        overflow: hidden;
        width: 100%;
      }

      .grid {
        display: flex;
        gap: 16px;
        transition: transform 0.6s ease-in-out;
        will-change: transform;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: hidden;
        flex: 0 0 25%; /* 4 cartes visibles sur desktop */
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      }

      @media (max-width: 1024px) {
        .card { flex: 0 0 33.333%; } /* 3 cartes */
      }

      @media (max-width: 800px) {
        .card { flex: 0 0 50%; } /* 2 cartes */
      }

      @media (max-width: 550px) {
        .card { flex: 0 0 100%; } /* 1 carte */
      }

      .cover {
        position: relative;
        aspect-ratio: 16 / 9;
        background-size: cover;
        background-position: center;
      }

      .badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background: white;
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 6px 10px;
        font-size: 12px;
        color: var(--brand);
        font-weight: 600;
      }

      .content {
        padding: 14px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .content h3 { margin: 0; font-size: 16.5px; }
      .meta { font-size: 13px; color: var(--muted); }
      .synopsis { font-size: 13px; line-height: 1.5; color: var(--text); max-height: 3.5em; overflow: hidden; }

      .actions {
        margin-top: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        padding: 0 14px 14px 14px;
      }

      .btn {
        background: linear-gradient(135deg, var(--brand), var(--brand-2));
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        text-decoration: none;
        font-weight: 600;
      }

      .ghost {
        border: 1px solid var(--brand);
        background: transparent;
        color: var(--brand);
        padding: 8px 12px;
        border-radius: 10px;
        text-decoration: none;
      }

      .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255,255,255,0.95);
        border: 1px solid var(--border);
        border-radius: 50%;
        width: 38px;
        height: 38px;
        font-size: 22px;
        color: var(--brand);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        transition: all 0.3s ease;
      }

      .carousel-btn:hover { background: var(--brand); color: white; }
      .carousel-btn.left { left: -18px; }
      .carousel-btn.right { right: -18px; }

      footer {
        text-align: center;
        color: var(--muted);
        font-size: 12px;
        margin: 40px 0;
      }
    </style>
  </head>

  <body>
    <div class="hero"><h1>√âv√©nements √† Poitiers</h1></div>

    <!-- üîç Barre de recherche + filtres -->
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Rechercher un √©v√©nement √† Poitiers (ex : concert, film, humour...)" />
      <div class="filters">
        <label class="filter-item"><input type="checkbox" value="CGR" checked /> üé¨ CGR</label>
        <label class="filter-item"><input type="checkbox" value="Arena" checked /> üé§ Arena</label>
        <label class="filter-item"><input type="checkbox" value="Republic" checked /> üé≠ Republic Corner</label>
        <label class="filter-item"><input type="checkbox" value="Parc Expo" checked /> üèõÔ∏è Parc Expo</label>
        <label class="filter-item"><input type="checkbox" value="TAP" checked /> üé≠ TAP Poitiers</label>
        <label class="filter-item"><input type="checkbox" value="Confort Moderne" checked /> üé∏ Confort Moderne</label>
      </div>
    </div>

    <div class="wrap">
      <h2 class="section-title">üé¨ Films √† l'affiche (CGR)</h2>
      <div class="carousel-container">
        <button class="carousel-btn left" data-target="gridCGR">‚Äπ</button>
        <section class="grid" id="gridCGR"></section>
        <button class="carousel-btn right" data-target="gridCGR">‚Ä∫</button>
      </div>

      <h2 class="section-title">üé§ Concerts & Spectacles (Arena)</h2>
      <div class="carousel-container">
        <button class="carousel-btn left" data-target="gridArena">‚Äπ</button>
        <section class="grid" id="gridArena"></section>
        <button class="carousel-btn right" data-target="gridArena">‚Ä∫</button>
      </div>

      <h2 class="section-title">üé≠ Soir√©es & Humour (Republic Corner)</h2>
      <div class="carousel-container">
        <button class="carousel-btn left" data-target="gridRC">‚Äπ</button>
        <section class="grid" id="gridRC"></section>
        <button class="carousel-btn right" data-target="gridRC">‚Ä∫</button>
      </div>

      <h2 class="section-title">üèõÔ∏è √âv√©nements (Parc Expo Grand Poitiers)</h2>
      <div class="carousel-container">
        <button class="carousel-btn left" data-target="gridExpo">‚Äπ</button>
        <section class="grid" id="gridExpo"></section>
        <button class="carousel-btn right" data-target="gridExpo">‚Ä∫</button>
      </div>

      <h2 class="section-title">üé≠ TAP Poitiers (Cin√©ma & Spectacles)</h2>
      <div class="carousel-container">
        <button class="carousel-btn left" data-target="gridTAP">‚Äπ</button>
        <section class="grid" id="gridTAP"></section>
        <button class="carousel-btn right" data-target="gridTAP">‚Ä∫</button>
      </div>

      <h2 class="section-title">üé∏ Confort Moderne</h2>
      <div class="carousel-container">
        <button class="carousel-btn left" data-target="gridCM">‚Äπ</button>
        <section class="grid" id="gridCM"></section>
        <button class="carousel-btn right" data-target="gridCM">‚Ä∫</button>
      </div>

      <footer>‚ú¶ Donn√©es issues de <strong>events.json</strong> (CGR, Arena, Republic Corner, Parc Expo, TAP & Confort Moderne).</footer>
    </div>

    <script>
      let allEvents = [];

      async function loadEvents() {
        const r = await fetch('./events.json?v=' + Date.now(), { cache: 'no-store' });
        return r.ok ? await r.json() : { events: [] };
      }

      function renderAll(events) {
        const grids = {
          CGR: document.getElementById('gridCGR'),
          Arena: document.getElementById('gridArena'),
          RC: document.getElementById('gridRC'),
          Expo: document.getElementById('gridExpo'),
          TAP: document.getElementById('gridTAP'),
          CM: document.getElementById('gridCM')
        };
        Object.values(grids).forEach(g => g.innerHTML = '');

        events.forEach(ev => {
          const poster = ev.poster || '';
          const rel = ev.release ? new Date(ev.release).toLocaleDateString() : '';
          const cardHTML = `
            <article class="card">
              <div class="cover" style="background-image:url('${poster}')">
                ${rel ? `<div class="badge">${rel}</div>` : ''}
              </div>
              <div class="content">
                <h3>${ev.title || 'Sans titre'}</h3>
                <div class="meta">${ev.cinema || ''} ¬∑ ${ev.date || ''}</div>
              </div>
              <div class="actions">
                <a class="ghost" href="${ev.source}" target="_blank">Plus d'infos</a>
                <a class="btn" href="${ev.source}" target="_blank">Voir</a>
              </div>
            </article>`;
          if (grids[ev.cinema?.includes('CGR') ? 'CGR' :
              ev.cinema?.includes('Arena') ? 'Arena' :
              ev.cinema?.includes('Republic') ? 'RC' :
              ev.cinema?.includes('Parc Expo') ? 'Expo' :
              ev.cinema?.includes('TAP') ? 'TAP' :
              ev.cinema?.includes('Confort Moderne') ? 'CM' : null]) {
            grids[ev.cinema.includes('CGR') ? 'CGR' :
              ev.cinema.includes('Arena') ? 'Arena' :
              ev.cinema.includes('Republic') ? 'RC' :
              ev.cinema.includes('Parc Expo') ? 'Expo' :
              ev.cinema.includes('TAP') ? 'TAP' :
              'CM'].insertAdjacentHTML('beforeend', cardHTML);
          }
        });
      }

      function setupCarousels() {
        document.querySelectorAll('.carousel-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const targetId = btn.dataset.target;
            const grid = document.getElementById(targetId);
            if (!grid) return;

            const container = grid.closest('.carousel-container');
            const visibleWidth = container.offsetWidth;
            const scrollAmount = visibleWidth * 0.9;

            const current = parseFloat(grid.dataset.offset || 0);
            let next = current;

            if (btn.classList.contains('left')) {
              next = Math.min(current + scrollAmount, 0);
            } else {
              const maxScroll = -(grid.scrollWidth - visibleWidth);
              next = Math.max(current - scrollAmount, maxScroll);
            }

            grid.style.transform = `translateX(${next}px)`;
            grid.dataset.offset = next;
          });
        });
      }

      (async function() {
        const data = await loadEvents();
        allEvents = data.events || [];
        renderAll(allEvents);
        setupCarousels();
      })();
    </script>
  </body>
</html>
